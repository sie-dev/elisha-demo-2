<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SIE ××¢×¨×›×ª ×—×™×¤×•×© ×•×ª×¨×’×•× ×—×¡×™×“×™ ×××•×—×“×ª</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            line-height: 1.6;
            color: #C79A51;
            background: linear-gradient(135deg, #000000 0%, #1a1a1a 50%, #333333 100%);
            min-height: 100vh;
            direction: rtl;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            text-align: center;
        }

        .header h1 {
            color: #C79A51;
            margin-bottom: 10px;
        }

        .nav-tabs {
            display: flex;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 10px;
            margin-bottom: 20px;
            overflow: hidden;
        }

        .nav-tab {
            flex: 1;
            padding: 15px;
            background: transparent;
            border: none;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
            color: #666;
        }

        .nav-tab.active {
            background: linear-gradient(135deg, #C79A51, #DAB760);
            color: white;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .main-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            height: 80vh;
        }

        .panel {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 20px;
            overflow-y: auto;
        }

        /* Search Panel */
        .search-controls {
            margin-bottom: 20px;
        }

        .search-input {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            margin-bottom: 10px;
            font-family: 'Times New Roman', serif;
            direction: rtl;
        }

        .action-btn {
            background: linear-gradient(135deg, #C79A51, #DAB760);
            color: black;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            margin-left: 10px;
        }

        .action-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 15px rgba(199, 154, 81, 0.3);
        }

        .action-btn:disabled {
            opacity: 0.7;
            cursor: not-allowed;
            transform: none;
        }

        /* Results */
        .results-area {
            margin-top: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            max-height: 500px;
            overflow-y: auto;
            background: #f8f9fa;
        }

        .hebrew-text {
            font-family: 'Times New Roman', serif;
            font-size: 16px;
            line-height: 1.8;
            direction: rtl;
            text-align: right;
        }

        .english-text {
            direction: ltr;
            text-align: left;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #ddd;
        }

        /* Translation Panel */
        .sefarim-selector {
            margin-bottom: 15px;
        }

        .sefer-select, .language-select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 6px;
            margin-bottom: 10px;
        }

        .chunk-display {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            background: #f8f9fa;
            max-height: 200px;
            overflow-y: auto;
        }

        .translation-result {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            background: white;
            max-height: 300px;
            overflow-y: auto;
        }

        .loading {
            text-align: center;
            padding: 20px;
            color: #666;
        }

        .error {
            background: #f8d7da;
            color: #721c24;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }

        .success {
            background: #d4edda;
            color: #155724;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }

        @media (max-width: 768px) {
            .main-grid {
                grid-template-columns: 1fr;
                grid-template-rows: auto auto;
                height: auto;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ” SIE ××¢×¨×›×ª ×—×™×¤×•×© ×•×ª×¨×’×•× ×—×¡×™×“×™ ×××•×—×“×ª</h1>
            <p>×—×™×¤×•×©, × ×™×ª×•×— ×•×ª×¨×’×•× ×˜×§×¡×˜×™× ×—×¡×™×“×™×™× ×‘××¢×¨×›×ª ××—×ª</p>
        </div>

        <!-- Navigation Tabs -->
        <div class="nav-tabs">
            <button class="nav-tab active" onclick="switchTab('search')">ğŸ” ×—×™×¤×•×© ×•× ×™×ª×•×—</button>
            <button class="nav-tab" onclick="switchTab('translate')">ğŸ”„ ×ª×¨×’×•× ×¡×¤×¨×™×</button>
            <button class="nav-tab" onclick="switchTab('integrated')">ğŸ¯ ×ª×¨×’×•× ××—×™×¤×•×©</button>
        </div>

        <!-- Search Tab -->
        <div id="search-tab" class="tab-content active">
            <div class="main-grid">
                <div class="panel">
                    <h3>×—×™×¤×•×© ×‘×§×•×¨×¤×•×¡ ×”×—×¡×™×“×™</h3>
                    <div class="search-controls">
                        <input type="text" class="search-input" id="search-query"
                               placeholder="×—×¤×© ××•×©×’×™×: ×‘× ×™×Ÿ ×”××œ×›×•×ª, ×‘×¨×›×ª ×›×”× ×™×, ×©×©×™× ×’×‘×•×¨×™×...">
                        <button class="action-btn" onclick="performSearch()">×—×¤×©</button>
                        <button class="action-btn" onclick="translateSearchResults()">×ª×¨×’× ×ª×•×¦××•×ª</button>
                    </div>
                    <div class="results-area" id="search-results">
                        <div class="loading">×”×›× ×¡ ××•×©×’ ×œ×—×™×¤×•×©...</div>
                    </div>
                </div>

                <div class="panel">
                    <h3>× ×™×ª×•×— ×•×ª×¨×’×•×</h3>
                    <div class="results-area" id="analysis-results">
                        <div class="loading">×”×ª×•×¦××•×ª ×™×•×¤×™×¢×• ×›××Ÿ...</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Translation Tab -->
        <div id="translate-tab" class="tab-content">
            <div class="main-grid">
                <div class="panel">
                    <h3>×‘×—×™×¨×ª ×¡×¤×¨ ×•×¤×¨×§</h3>
                    <div class="sefarim-selector">
                        <select class="sefer-select" id="sefer-select" onchange="loadSefer()">
                            <option value="">×‘×—×¨ ×¡×¤×¨ ×œ×ª×¨×’×•×...</option>
                        </select>
                        <select class="language-select" id="language-select">
                            <option value="English">English</option>
                            <option value="Yiddish">×™×™×“×™×©</option>
                            <option value="French">FranÃ§ais</option>
                        </select>
                    </div>
                    <div class="chunk-display hebrew-text" id="selected-chunk">
                        ×‘×—×¨ ×¡×¤×¨ ×•×—×œ×§ ×œ×ª×¨×’×•×...
                    </div>
                    <button class="action-btn" onclick="translateChunk()" disabled id="translate-btn">×ª×¨×’× ×¤×¨×§</button>
                </div>

                <div class="panel">
                    <h3>×ª×¨×’×•×</h3>
                    <div class="translation-result" id="translation-output">
                        ×”×ª×¨×’×•× ×™×•×¤×™×¢ ×›××Ÿ...
                    </div>
                </div>
            </div>
        </div>

        <!-- Integrated Tab -->
        <div id="integrated-tab" class="tab-content">
            <div class="main-grid">
                <div class="panel">
                    <h3>×—×™×¤×•×© ××ª×§×“× ×¢× ×ª×¨×’×•×</h3>
                    <div class="search-controls">
                        <input type="text" class="search-input" id="integrated-query"
                               placeholder="×—×¤×© ×•×§×‘×œ × ×™×ª×•×— ××ª×•×¨×’×...">
                        <select class="language-select" id="integrated-language">
                            <option value="English">English</option>
                            <option value="Yiddish">×™×™×“×™×©</option>
                        </select>
                        <button class="action-btn" onclick="performIntegratedSearch()">×—×¤×© ×•×ª×¨×’×</button>
                    </div>
                </div>
                <div class="panel">
                    <h3>×ª×•×¦××•×ª ××ª×•×¨×’××•×ª</h3>
                    <div class="results-area" id="integrated-results">
                        <div class="loading">×”×ª×•×¦××•×ª ×”××ª×•×¨×’××•×ª ×™×•×¤×™×¢×• ×›××Ÿ...</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        class UnifiedChabadInterface {
            constructor() {
                this.baseUrl = window.location.hostname.includes('github.io') ?
                    'https://your-railway-app.railway.app' : 'http://localhost:3001';
                this.sefarim = [];
                this.currentSearchResults = null;
                this.demoMode = false; // Railway backend available

                if (this.demoMode) {
                    this.initDemoData();
                } else {
                    this.loadSefarimList();
                }
            }

            initDemoData() {
                this.sefarim = [
                    { name: '×œ×§×•×˜×™ ×ª×•×¨×” - Likkutei Torah', path: 'demo/likkutei_torah.txt', size: 245000 },
                    { name: '×ª×•×¨×” ××•×¨ - Torah Or', path: 'demo/torah_or.txt', size: 180000 },
                    { name: '×“×¨×š ××¦×•×ª×™×š - Derech Mitzvotecha', path: 'demo/derech_mitzvotecha.txt', size: 165000 }
                ];
                this.populateSefarimSelect();
            }

            async loadSefarimList() {
                try {
                    const response = await fetch(`${this.baseUrl}/sefarim`);
                    const data = await response.json();
                    this.sefarim = data.sefarim;
                    this.populateSefarimSelect();
                } catch (error) {
                    console.error('Error loading sefarim:', error);
                }
            }

            populateSefarimSelect() {
                const select = document.getElementById('sefer-select');
                this.sefarim.forEach(sefer => {
                    const option = document.createElement('option');
                    option.value = sefer.path;
                    option.textContent = sefer.name;
                    select.appendChild(option);
                });
            }

            async performSearch() {
                const query = document.getElementById('search-query').value.trim();
                if (!query) return;

                const resultsDiv = document.getElementById('search-results');
                resultsDiv.innerHTML = '<div class="loading">××—×¤×©...</div>';

                if (this.demoMode) {
                    this.performDemoSearch(query, resultsDiv);
                    return;
                }

                try {
                    const response = await fetch(`${this.baseUrl}/search`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ query: query })
                    });

                    const data = await response.json();
                    this.currentSearchResults = data;

                    if (data.analysis && data.analysis.content) {
                        resultsDiv.innerHTML = `<div class="hebrew-text">${data.analysis.content[0].text}</div>`;
                    } else {
                        resultsDiv.innerHTML = '<div class="error">×œ× × ××¦××• ×ª×•×¦××•×ª</div>';
                    }
                } catch (error) {
                    resultsDiv.innerHTML = '<div class="error">×©×’×™××” ×‘×—×™×¤×•×©</div>';
                }
            }

            performDemoSearch(query, resultsDiv) {
                const demoResponses = {
                    "×‘× ×™×Ÿ ×”××œ×›×•×ª": `×“×¢, ×“×‘×¨×›×ª ×›×”× ×™× - "×™×‘×¨×›×š ×”' ×•×™×©××¨×š" - ××“×•×‘×¨ ×¢×œ ×‘× ×™×Ÿ ×”××œ×›×•×ª ×”×¢×œ×™×•× ×”.
    ×›××• ×©×›×ª×‘ ×”××¨×™×–"×œ ×‘×¤×¨×™ ×¢×¥ ×—×™×™×, ×©××œ×›×•×ª ×”×™× ×”×¡×¤×™×¨×” ×”×ª×—×ª×•× ×” ×©××§×‘×œ×ª ××›×œ ×”×¡×¤×™×¨×•×ª ×”×¢×œ×™×•× ×•×ª.

    ×•×‘×œ×§×•×˜×™ ×ª×•×¨×” ××‘×•××¨, ×©×›×œ ×™×©×¨××œ ×”× "×××œ×›×ª ×›×”× ×™× ×•×’×•×™ ×§×“×•×©", ×•×¢×œ ×™×“×™ ×¢×‘×•×“×ª× ×”× ×‘×•× ×™× ××ª ×”××œ×›×•×ª ×“×§×“×•×©×”.`,

                    "×‘×¨×›×ª ×›×”× ×™×": `×‘×¨×›×ª ×›×”× ×™× ××•×¨×›×‘×ª ××©×œ×•×©×” ×¤×¡×•×§×™×:
    ×™×‘×¨×›×š ×”' ×•×™×©××¨×š - ×‘×¨×›×” ×’×©××™×ª
    ×™××¨ ×”' ×¤× ×™×• ××œ×™×š - ×‘×¨×›×” ×¨×•×—× ×™×ª
    ×™×©× ×”' ×¤× ×™×• ××œ×™×š - ×©×œ×•×

    ×•×‘×ª×•×¨×ª ×—×‘"×“ ××‘×•××¨ ×©×”×‘×¨×›×•×ª ×”×œ×œ×• ××ª×™×™×—×¡×•×ª ×œ×©×œ×•×© ×”×§×•×•×™× - ×™××™×Ÿ, ×©×××œ, ×•×××¦×¢.`,

                    "×©×©×™× ×’×‘×•×¨×™×": `×©×©×™× ×’×‘×•×¨×™× ×¡×‘×™×‘ ×œ××˜×ª×• ×©×œ ×©×œ××” - ××œ×• ×©×©×™× ××œ×£ ××•×ª×™×•×ª ×”×ª×•×¨×”.
    ×›×œ ××•×ª ×‘×ª×•×¨×” ×”×™× ×›××• ×’×‘×•×¨ ×”×©×•××¨ ×¢×œ ×§×“×•×©×ª ×”×ª×•×¨×”.

    ×•×›××• ×©××‘×•××¨ ×‘×–×•×”×¨, ×©×©×™× ×”×•× ××¡×¤×¨ ×”××™×™×¦×’ ×©×œ××•×ª ×•×’×‘×•×¨×”.`
                };

                let response = null;
                for (const [key, value] of Object.entries(demoResponses)) {
                    if (query.includes(key) || key.includes(query)) {
                        response = value;
                        break;
                    }
                }

                if (!response) {
                    response = `×“×•×’××” ×œ×ª×•×¦××” ×¢×‘×•×¨ "${query}":

×–×•×”×™ ×’×¨×¡×ª ×“××• ×©×œ ×—×™×¤×•×© ×‘×§×•×¨×¤×•×¡ ×”×—×¡×™×“×™. ×‘×’×¨×¡×” ×”××œ××”, ×”×—×™×¤×•×© ×™×ª×‘×¦×¢ ×‘×××’×¨ ×”××œ× ×©×œ ×›×œ ×”×¡×¤×¨×™× ×”×—×¡×™×“×™×™×.

×”×ª×•×¦××•×ª ×™×›×œ×œ×•:
â€¢ ×§×˜×¢×™× ××ª×•×¨×ª ×—×‘"×“
â€¢ ××§×•×¨×•×ª ××”×–×•×”×¨ ×•××”××¨×™×–"×œ
â€¢ ×”×¡×‘×¨×™× ×‘×¢×‘×¨×™×ª, ×™×™×“×™×© ×•×× ×’×œ×™×ª
â€¢ ×¦×™×•× ×™ ××§×•×¨×•×ª ××“×•×™×§×™×

×–×•×”×™ ×ª×¦×•×’×” ××§×“×™××” ×‘×œ×‘×“.`;
                }

                this.currentSearchResults = {
                    analysis: { content: [{ text: response }] }
                };

                setTimeout(() => {
                    resultsDiv.innerHTML = `<div class="hebrew-text">${response}</div>`;
                }, 800);
            }

            async translateSearchResults() {
                if (!this.currentSearchResults) {
                    alert('×‘×¦×¢ ×—×™×¤×•×© ×§×•×“×');
                    return;
                }

                const analysisDiv = document.getElementById('analysis-results');
                analysisDiv.innerHTML = '<div class="loading">××ª×¨×’×...</div>';

                try {
                    const textToTranslate = this.currentSearchResults.analysis.content[0].text;
                    const response = await fetch(`${this.baseUrl}/translate`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            text: textToTranslate,
                            target_language: 'English'
                        })
                    });

                    const data = await response.json();
                    analysisDiv.innerHTML = `
                        <div class="hebrew-text">${data.original}</div>
                        <div class="english-text">${data.translation}</div>
                    `;
                } catch (error) {
                    analysisDiv.innerHTML = '<div class="error">×©×’×™××” ×‘×ª×¨×’×•×</div>';
                }
            }

            async loadSefer() {
                const seferPath = document.getElementById('sefer-select').value;
                if (!seferPath) return;

                try {
                    const response = await fetch(`${this.baseUrl}/sefer/${encodeURIComponent(seferPath)}/chunks`);
                    const data = await response.json();

                    if (data.chunks.length > 0) {
                        document.getElementById('selected-chunk').textContent = data.chunks[0].content;
                        document.getElementById('translate-btn').disabled = false;
                    }
                } catch (error) {
                    console.error('Error loading sefer:', error);
                }
            }

            async translateChunk() {
                const chunkText = document.getElementById('selected-chunk').textContent;
                const targetLang = document.getElementById('language-select').value;
                const outputDiv = document.getElementById('translation-output');

                outputDiv.innerHTML = '<div class="loading">××ª×¨×’×...</div>';

                try {
                    const response = await fetch(`${this.baseUrl}/translate`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            text: chunkText,
                            target_language: targetLang
                        })
                    });

                    const data = await response.json();
                    outputDiv.innerHTML = data.translation;
                } catch (error) {
                    outputDiv.innerHTML = '<div class="error">×©×’×™××” ×‘×ª×¨×’×•×</div>';
                }
            }

            async performIntegratedSearch() {
                const query = document.getElementById('integrated-query').value.trim();
                const targetLang = document.getElementById('integrated-language').value;
                if (!query) return;

                const resultsDiv = document.getElementById('integrated-results');
                resultsDiv.innerHTML = '<div class="loading">××—×¤×© ×•××ª×¨×’×...</div>';

                try {
                    // First search
                    const searchResponse = await fetch(`${this.baseUrl}/search`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ query: query })
                    });

                    const searchData = await searchResponse.json();

                    if (searchData.analysis && searchData.analysis.content) {
                        // Then translate
                        const translateResponse = await fetch(`${this.baseUrl}/translate`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                text: searchData.analysis.content[0].text,
                                target_language: targetLang
                            })
                        });

                        const translateData = await translateResponse.json();
                        resultsDiv.innerHTML = `
                            <div class="hebrew-text">
                                <h4>××§×•×¨×™:</h4>
                                ${translateData.original}
                            </div>
                            <div class="english-text">
                                <h4>×ª×¨×’×•× ×œ${targetLang}:</h4>
                                ${translateData.translation}
                            </div>
                        `;
                    } else {
                        resultsDiv.innerHTML = '<div class="error">×œ× × ××¦××• ×ª×•×¦××•×ª</div>';
                    }
                } catch (error) {
                    resultsDiv.innerHTML = '<div class="error">×©×’×™××” ×‘×—×™×¤×•×© ××• ×ª×¨×’×•×</div>';
                }
            }
        }

        // Tab switching
        function switchTab(tabName) {
            document.querySelectorAll('.nav-tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));

            event.target.classList.add('active');
            document.getElementById(`${tabName}-tab`).classList.add('active');
        }

        // Global functions for onclick handlers
        let unifiedInterface;

        function performSearch() {
            unifiedInterface.performSearch();
        }

        function translateSearchResults() {
            unifiedInterface.translateSearchResults();
        }

        function loadSefer() {
            unifiedInterface.loadSefer();
        }

        function translateChunk() {
            unifiedInterface.translateChunk();
        }

        function performIntegratedSearch() {
            unifiedInterface.performIntegratedSearch();
        }

        // Initialize
        window.onload = () => {
            unifiedInterface = new UnifiedChabadInterface();
        };
    </script>
</body>
</html>